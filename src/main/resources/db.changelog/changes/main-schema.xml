<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
        http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.3.xsd">

    <changeSet id="1" author="youssef">
        <sql>
            -- Doctor profiles
            CREATE TABLE doctor (
                id UUID PRIMARY KEY,
                name VARCHAR(100) NOT NULL,
                email VARCHAR(100) UNIQUE NOT NULL,
                specialty VARCHAR(20) NOT NULL CHECK (specialty IN ('GENERAL', 'CARDIOLOGY', 'DERMATOLOGY'))
            );

            CREATE TABLE time_slot (
                id UUID PRIMARY KEY,
                doctor_id UUID NOT NULL REFERENCES doctor(id) ON DELETE CASCADE,
                slot_datetime TIMESTAMP NOT NULL,
                duration INTEGER NOT NULL,
                UNIQUE(doctor_id, slot_datetime)
            );

            CREATE TABLE patient (
                id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                name VARCHAR(100) NOT NULL,
                email VARCHAR(100) UNIQUE NOT NULL,
                phone VARCHAR(20) NOT NULL,
                date_of_birth TIMESTAMP
            );

            CREATE TABLE appointment (
                id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
                slot_id UUID NOT NULL REFERENCES time_slot(id) ON DELETE RESTRICT,
                patient_id UUID NOT NULL REFERENCES patient(id) ON DELETE CASCADE,
                doctor_id UUID NOT NULL REFERENCES doctor(id) ON DELETE RESTRICT,
                appointment_type VARCHAR(20) NOT NULL CHECK (appointment_type IN ('CONSULTATION', 'FOLLOWUP')),
                status VARCHAR(20) NOT NULL
                CHECK (status IN ('RESERVED', 'IN_PROGRESS', 'COMPLETED', 'CANCELLED')),
                reserved_at TIMESTAMP
            );

        </sql>
    </changeSet>
</databaseChangeLog>